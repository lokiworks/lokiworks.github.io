<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">


<title data-react-helmet="true">软件设计 | Loki</title>

<meta data-react-helmet="true" property="og:title" content="软件设计 | Loki"><meta data-react-helmet="true" name="description" content="# 软件设计"><meta data-react-helmet="true" property="og:description" content="# 软件设计"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.98bfffcc.css">


<link rel="preload" href="/styles.c771d9e1.js" as="script">

<link rel="preload" href="/runtime~main.c4830311.js" as="script">

<link rel="preload" href="/main.263c29fc.js" as="script">

<link rel="preload" href="/common.1eec3b24.js" as="script">

<link rel="preload" href="/2.46fd2166.js" as="script">

<link rel="preload" href="/ccc49370.7a4e6822.js" as="script">

<link rel="preload" href="/890e27f6.49a5393e.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Loki</strong></a><a class="navbar__item navbar__link" href="/docs/doc1">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/lokiworks/lokiworks.github.io" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Loki</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/doc1">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/blog">Blog</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/lokiworks/lokiworks.github.io" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_2RZH">软件设计</h1><div class="margin-vert--md"><time datetime="2020-05-09T00:00:00.000Z" class="blogPostDate_3tRe">May 9, 2020  · 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://lokiworks.github.io" target="_blank" rel="noreferrer noopener"><img src="https://avatars1.githubusercontent.com/u/16199375?v=4" alt="Loki"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://lokiworks.github.io" target="_blank" rel="noreferrer noopener">Loki</a></h4><small class="avatar__subtitle">SE</small></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="软件设计"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#软件设计" title="Direct link to heading">#</a>软件设计</h1><p>本来是想写篇软件分层的文章，想想介绍的内容不单单是要阐述软件分层的思想。下面以一个具体的例子进入主题</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="骨架工程"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#骨架工程" title="Direct link to heading">#</a>骨架工程</h2><p>骨架工程的目的是将软件开发过程中的最佳实践、可重用的代码引入到框架中，形成一套标准。方便他人能够快速的融入到团队的开发规范中，更快、更有效的开发代码，将精力都集中在业务场景下的代码逻辑上，避免了不必要的分心。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="名词解释"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#名词解释" title="Direct link to heading">#</a>名词解释</h3><table><thead><tr><th>术语</th><th>全称</th><th>说明</th></tr></thead><tbody><tr><td>DTO</td><td>Data Trafer Object</td><td></td></tr><tr><td>DAO</td><td>Data Access Object</td><td></td></tr><tr><td>DO</td><td>Domain Object</td><td></td></tr><tr><td>app</td><td>application</td><td></td></tr><tr><td>intgr</td><td>integration</td><td></td></tr><tr><td>vo</td><td>value object</td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="目录结构"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#目录结构" title="Direct link to heading">#</a>目录结构</h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-app       # 包含了一系列@RestController</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-domain    # 包含了一系列@Service和@Component和DO实体模型</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-dal       # 包含了一系列@Mapper和DAO实体模型</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-intgr     # 包含了一系列其他业务的xxx-client及第三方平台sdk的封装</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-util      # 包含了一系列XXXUtils工具类</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-api       # 包含了出入参的DTO实体模型以及API接口</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└── arch-client    # 包含了一系列@FeignClient</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="结构图"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#结构图" title="Direct link to heading">#</a>结构图</h3><p><img src="../img/software-multitier.jpg" alt="software-design">
打包时会将<strong>arch-api</strong>及<strong>arch-client</strong>部署到私服中，供其他业务使用方使用</p><ul><li><strong>arch-app</strong> 引用了arch-api、arch-domain、arch-intgr，所有的@RestController都实现了arch-api定义的接口</li><li><strong>arch-domain</strong> 引用了arch-dal和arch-util</li><li><strong>arch-client</strong> 引用了arch-api</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="优化版本v1"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#优化版本v1" title="Direct link to heading">#</a>优化版本V1</h3><ol><li><p>arch-domain如何使用arch-api中的实体模型?</p><p>可以从arch-api中分离出arch-api-bean， arch-domain引用arch-api-bean</p></li><li><p>arch-domain如何使用arch-app中的实体模型?</p><p>arch-app引用了arch-api，理论上不会需要自定义实体。实际操作时并不需要把所有的接口都暴露给业务使用方，只暴露业务使用方需要的接口，所以arch-app中会存在实体模型。
可以从arch-app中分离出arch-app-bean，arch-domain引用arch-app-bean</p></li><li><p>arch-client中如何提供扩展点给业务使用方做业务降级?
通过Spring提供的ApplicationContext获取业务使用方自定义的降级对象</p></li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@FeignClient(value = &quot;xxx&quot;, path = &quot;api/v1/xxx&quot;, fallbackFactory = XXXClientFallbackFactory.class)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public interface IXXXClient extends IXXXApi {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @RequestMapping(value = &quot;xxxAction&quot;, method = RequestMethod.GET)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ResponseEntityDTO&lt;DemoRespDTO&gt; xxxAction(@RequestParam(value = &quot;name&quot;) String name);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Component</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class XXXClientFallbackFactory  extends AbstractFallbackFactory&lt;IXXXClient&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Value(&quot;${xxx.xxxClientExtend}&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private String xxxClientExtend;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Autowired</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ApplicationContext appContext;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public IXXXClientClient createCustomObject() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (appContext != null){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if (StringUtils.isNotBlank(xxxClientExtend)){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return  (IXXXClientClient) appContext.getBean(xxxClientExtend);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Slf4j</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract  class AbstractFallbackFactory&lt;T&gt; implements FallbackFactory&lt;T&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public abstract T createCustomObject();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @SuppressWarnings(&quot;unchecked&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public T create(Throwable cause) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        T obj = createCustomObject();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (obj != null){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return obj;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return (T) Proxy.newProxyInstance(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                getEntityClass().getClassLoader(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                new Class[] { getEntityClass() }, new FeignExceptionHandler(cause));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private Class getEntityClass() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Class clazz = getClass();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Type type = clazz.getGenericSuperclass();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ParameterizedType p = (ParameterizedType)type;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return (Class) p.getActualTypeArguments()[0];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class FeignExceptionHandler implements InvocationHandler {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private Throwable cause;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        FeignExceptionHandler(Throwable cause) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            this.cause = cause;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public Object invoke(Object proxy, Method method, Object[] args) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            log.error(&quot;invoke failed, error message:{}&quot;, cause.getMessage());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return ResponseEntityDTO.failure(ResponseCode.FAILED);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><blockquote><p><strong>Tips:</strong> </p><ul><li>优化版本V1 在原来的基础上多增加了两层结构：arch-api-bean和arch-app-bean，使得骨架显得臃肿。能不能抽取出arch-bean，用于放置各种类型的bean？</li><li>创建扩展点对象是arch-client的职责吗？</li></ul><p>这两个问题留给读者思考，如有疑问请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="优化版本v2"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#优化版本v2" title="Direct link to heading">#</a>优化版本V2</h3><ol><li>调整模型的依赖结构，优化<a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv1">优化版本V1</a>中的优化点1、2，调整后的结构见下图
<img src="../img/software-multitier-inner-structure.jpg" alt="software-design"></li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-app</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-domain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  ├─model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  │  ├─converter # 用于存放实体模型转换</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  │  ├─do        # 领域实体模型，提供本领域内业务的方法</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  │  └─vo        # 值实体模型</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─service      # 轻service，内部调用do对象及repo完成业务逻辑</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│      └─facade   # 封装多个service的复杂操作</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-dal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  ├─model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─repo         # 封装数据访问层的增删改查的操作</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-intgr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  ├─facade       # 第三方接口出入参适配层</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─model        # 用于存放第三方实体模型</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-utils</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-api</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">└─arch-client</span></div></div></div></div></div><blockquote><p><strong>Tips:</strong></p><ul><li>arch-app中@RestController下的接口实现arch-api包下的API接口。</li><li>arch-domain中service包下的接口继承自arch-api包下的API接口。为什么要继承API接口？这个问题留给读者思考，如有疑问请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</li><li>arch-api接口方法中加入@RequestMapping、@RequestBody、@RequestParam，避免arch-client和arch-app做相同的操作</li><li>arch-util放在总的pom中，横跨arch-dal、arch-intgr、arch-domain、arch-app</li></ul></blockquote><ol><li>调整arch-client中扩展点的代码，优化<a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv1">优化版本V1</a>中的优化点3，调整后的代码如下</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-java codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Component</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class XXXClientFallbackFactory extends GenericFallbackFactory&lt;IXXXApi&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public XXXClientFallbackFactory(){}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public XXXClientFallbackFactory(IXXXApi xxxApi){super(xxxApi);}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Slf4j</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public  class GenericFallbackFactory&lt;T&gt; implements FallbackFactory&lt;T&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public GenericFallbackFactory(){}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public GenericFallbackFactory(T extend){this.extend = extend;}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protected   T extend;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @SuppressWarnings(&quot;unchecked&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public T create(Throwable cause) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        log.trace(&quot;fallback due to:{}&quot;, cause.getMessage(), cause);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (extend != null){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            log.debug(&quot;switch to extend fallback:{}&quot;, extend.getClass().getName());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return extend;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class ResponseEntityDTO&lt;T&gt; implements Serializable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final long serialVersionUID = -8567541939288898127L;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final ResponseEntityDTO SUCCEED = new ResponseEntityDTO(ResponseCode.SUCCEED);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final ResponseEntityDTO FAILED = new ResponseEntityDTO(ResponseCode.FAILED);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static &lt;T&gt; boolean successAndDataNotNull(ResponseEntityDTO&lt;T&gt; resp){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return success(resp) &amp;&amp; resp.data != null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static &lt;T&gt; boolean success(ResponseEntityDTO&lt;T&gt; resp){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return resp == null ? false:resp.succeed();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static &lt;T&gt; ResponseEntityDTO&lt;T&gt; safeWrap(ResponseEntityDTO&lt;T&gt; resp){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return resp==null?FAILED: resp;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    T data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    String message;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Integer errCode;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public boolean succeed() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return errCode==0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public ResponseEntityDTO(ResponseCode code){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        message = code.getMessage();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        errCode = code.getCode();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // 此处省略其他代码</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><blockquote><p><strong>Tips:</strong></p><ul><li>将创建拓展点的任务交给业务使用方，业务使用方使用@Bean告知Spring如何构建对象，并将拓展的xxxApi传入到XXXClientFallbackFactory对象中</li><li>实现FallbackFactory接口的目的只是为了知晓请求失败的原因，比如：服务down机、网络超时等，所以GenericFallbackFactory中只要记录下日志就可以了</li><li>当业务使用方提供了拓展点，则使用业务方提供的拓展点，否则不会做任何处理。为什么不在GenericFallbackFactory中构造新的对象从而在方法中返回默认的返回体？这个问题留给读者思考，如有疑问请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</li><li>通过ResponseEntityDTO中的success、successAndDataNotNull对arch-client返回体做校验，safeWrap用于arch-app层，包装arch-domain层的返回体</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="优化版本v3"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#优化版本v3" title="Direct link to heading">#</a>优化版本V3</h3><ul><li>目前的骨架都是通过写好的模板，提供出去。可以通过一种自由的方式让用户去选择想要生成的骨架及使用的组件等。读者可以参考<a href="https://start.aliyun.com/">Aliyun Java Initializer</a>的实现</li><li>针对不同的业务提供不同的骨架</li><li><a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv2">优化版本V2</a>的方式能够满足单一技术栈的诉求，但是对于多技术栈显得无力。<a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv2">优化版本V2</a>的方式本质上还是基于契约编程。可以从文档契约上去思考，
定义接口无非是定义好接口的出入参以及方法名。这块可以基于<a href="https://www.openapis.org/">openapi</a>去做，当接口定义完毕可发布时。接口的使用方，可以在接口文档的平台中生成各自技术栈的基于当前文档库版本号对应的库，再细化的可以生成当前技术栈使用的框架(spring cloud、dubbo、grpc等)对应的库(lib、dll、jar等)</li><li>往往规范的出发点都是好的，如何保证使用骨架的人按照规范去执行？可以通过提供各种ide(vscode、idea等)插件，去提示用户。即使提示了，用户还是没有执行。这时可以通过骨架质检平台，扫描接入骨架的业务代码库，定期做质检分析。这块可以基于<a href="https://www.archunit.org/">archunit</a>去做</li><li>此处留给读者思考，如果你有其他好的想法，请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="结语"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#结语" title="Direct link to heading">#</a>结语</h3><blockquote><ul><li>不断的优化设计，是为了使用的人能够更高效并快乐的工作</li><li>所有的软件设计并不是一蹴而就的</li><li>软件是要分层的，但也要注意粒度。比较的典型的案例:TCP/IP VS OSI/RM</li><li>一个好的软件设计者，一定是一个好的产品设计者</li><li>软件的设计最终一定要形成闭环</li><li>软件的设计是基于特定的业务使用场景的</li></ul></blockquote><p>今天是母亲节，祝天下所有的母亲节日快乐!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="联系方式"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#联系方式" title="Direct link to heading">#</a>联系方式</h3><ul><li><p>欢迎订阅我的公众号，这里主要会发表些软件工程上的一些想法及实践
<img src="../img/weixin.jpg" alt="微信公众号"></p></li><li><p><a href="loki.yen@outlook.com">邮箱号</a> 欢迎通过邮件的方式与我交流</p></li><li><p><a href="https://teams.microsoft.com">Microsoft Teams</a>  账号同邮箱号，欢迎通过Teams与我交流</p></li><li><p><a href="https://github.com/lokiworks/design/issues">Github Issues</a> 欢迎通过issues的方式与我交流</p></li><li><p><a href="lokiworks.github.io">我的博客</a> 最近才搭建的，这会是我的第一篇文章</p></li></ul></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/design">design</a></div></footer></article><div><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2020-05-09-software-design.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/doc1">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc2">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/docusaurus">Stack Overflow</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://discordapp.com/invite/docusaurus">Discord</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://twitter.com/docusaurus">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/lokiworks/lokiworks.github.io">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 lokiworks, Inc. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/styles.c771d9e1.js"></script>

<script src="/runtime~main.c4830311.js"></script>

<script src="/main.263c29fc.js"></script>

<script src="/common.1eec3b24.js"></script>

<script src="/2.46fd2166.js"></script>

<script src="/ccc49370.7a4e6822.js"></script>

<script src="/890e27f6.49a5393e.js"></script>


</body>
</html>
<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Loki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Loki Blog Atom Feed"><title data-react-helmet="true">软件设计 | Loki</title><meta data-react-helmet="true" property="og:title" content="软件设计 | Loki"><meta data-react-helmet="true" name="description" content="本来是想写篇软件分层的文章，想想介绍的内容不单单是要阐述软件分层的思想。下面以一个具体的例子进入主题"><meta data-react-helmet="true" property="og:description" content="本来是想写篇软件分层的文章，想想介绍的内容不单单是要阐述软件分层的思想。下面以一个具体的例子进入主题"><meta data-react-helmet="true" property="og:url" content="https://lokiworks.github.io/blog/software-design"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://lokiworks.github.io/blog/software-design"><link data-react-helmet="true" rel="alternate" href="https://lokiworks.github.io/blog/software-design" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://lokiworks.github.io/blog/software-design" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.06ddfc87.css">
<link rel="preload" href="/assets/js/runtime~main.90d50ffe.js" as="script">
<link rel="preload" href="/assets/js/main.76acd87f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Loki</b></a><a class="navbar__item navbar__link" href="/docs/doc1">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lokiworks/lokiworks.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/git-engineering-practices">Git工程实践</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/database-version-management">数据库脚本版本管理工程实践</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/how-to-read-sourcecode">如何阅读源码</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/build-monorepo">构建单体仓库</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/software-design">软件设计</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="blogPostTitle_GeHD">软件设计</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2020-05-09T00:00:00.000Z">May 9, 2020</time> · 3 min read</div><div class="avatar margin-vert--md"><a href="https://lokiworks.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars1.githubusercontent.com/u/16199375?v=4" alt="Loki"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://lokiworks.github.io" target="_blank" rel="noopener noreferrer">Loki</a></div><small class="avatar__subtitle">SE</small></div></div></header><div class="markdown"><p>本来是想写篇软件分层的文章，想想介绍的内容不单单是要阐述软件分层的思想。下面以一个具体的例子进入主题</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="骨架工程"></a>骨架工程<a class="hash-link" href="#骨架工程" title="Direct link to heading">#</a></h2><p>骨架工程的目的是将软件开发过程中的最佳实践、可重用的代码引入到框架中，形成一套标准。方便他人能够快速的融入到团队的开发规范中，更快、更有效的开发代码，将精力都集中在业务场景下的代码逻辑上，避免了不必要的分心。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="名词解释"></a>名词解释<a class="hash-link" href="#名词解释" title="Direct link to heading">#</a></h3><table><thead><tr><th>术语</th><th>全称</th><th>说明</th></tr></thead><tbody><tr><td>DTO</td><td>Data Trafer Object</td><td></td></tr><tr><td>DAO</td><td>Data Access Object</td><td></td></tr><tr><td>DO</td><td>Domain Object</td><td></td></tr><tr><td>app</td><td>application</td><td></td></tr><tr><td>intgr</td><td>integration</td><td></td></tr><tr><td>vo</td><td>value object</td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="目录结构"></a>目录结构<a class="hash-link" href="#目录结构" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-app       # 包含了一系列@RestController</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-domain    # 包含了一系列@Service和@Component和DO实体模型</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-dal       # 包含了一系列@Mapper和DAO实体模型</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-intgr     # 包含了一系列其他业务的xxx-client及第三方平台sdk的封装</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-util      # 包含了一系列XXXUtils工具类</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├── arch-api       # 包含了出入参的DTO实体模型以及API接口</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└── arch-client    # 包含了一系列@FeignClient</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="结构图"></a>结构图<a class="hash-link" href="#结构图" title="Direct link to heading">#</a></h3><p><img alt="software-design" src="/assets/images/software-multitier-ba52251c924e9732a6ecf4a7bcfb2d2d.jpg">
打包时会将<strong>arch-api</strong>及<strong>arch-client</strong>部署到私服中，供其他业务使用方使用</p><ul><li><strong>arch-app</strong> 引用了arch-api、arch-domain、arch-intgr，所有的@RestController都实现了arch-api定义的接口</li><li><strong>arch-domain</strong> 引用了arch-dal和arch-util</li><li><strong>arch-client</strong> 引用了arch-api</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="优化版本v1"></a>优化版本V1<a class="hash-link" href="#优化版本v1" title="Direct link to heading">#</a></h3><ol><li><p>arch-domain如何使用arch-api中的实体模型?</p><p>可以从arch-api中分离出arch-api-bean， arch-domain引用arch-api-bean</p></li><li><p>arch-domain如何使用arch-app中的实体模型?</p><p>arch-app引用了arch-api，理论上不会需要自定义实体。实际操作时并不需要把所有的接口都暴露给业务使用方，只暴露业务使用方需要的接口，所以arch-app中会存在实体模型。
可以从arch-app中分离出arch-app-bean，arch-domain引用arch-app-bean</p></li><li><p>arch-client中如何提供扩展点给业务使用方做业务降级?
通过Spring提供的ApplicationContext获取业务使用方自定义的降级对象</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@FeignClient(value = &quot;xxx&quot;, path = &quot;api/v1/xxx&quot;, fallbackFactory = XXXClientFallbackFactory.class)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface IXXXClient extends IXXXApi {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @RequestMapping(value = &quot;xxxAction&quot;, method = RequestMethod.GET)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ResponseEntityDTO&lt;DemoRespDTO&gt; xxxAction(@RequestParam(value = &quot;name&quot;) String name);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Component</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class XXXClientFallbackFactory  extends AbstractFallbackFactory&lt;IXXXClient&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Value(&quot;${xxx.xxxClientExtend}&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private String xxxClientExtend;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Autowired</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ApplicationContext appContext;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public IXXXClientClient createCustomObject() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (appContext != null){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (StringUtils.isNotBlank(xxxClientExtend)){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return  (IXXXClientClient) appContext.getBean(xxxClientExtend);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return null;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Slf4j</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract  class AbstractFallbackFactory&lt;T&gt; implements FallbackFactory&lt;T&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public abstract T createCustomObject();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @SuppressWarnings(&quot;unchecked&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public T create(Throwable cause) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        T obj = createCustomObject();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (obj != null){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return obj;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return (T) Proxy.newProxyInstance(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                getEntityClass().getClassLoader(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                new Class[] { getEntityClass() }, new FeignExceptionHandler(cause));</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private Class getEntityClass() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Class clazz = getClass();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Type type = clazz.getGenericSuperclass();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ParameterizedType p = (ParameterizedType)type;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return (Class) p.getActualTypeArguments()[0];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    class FeignExceptionHandler implements InvocationHandler {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        private Throwable cause;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        FeignExceptionHandler(Throwable cause) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            this.cause = cause;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        @Override</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        public Object invoke(Object proxy, Method method, Object[] args) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            log.error(&quot;invoke failed, error message:{}&quot;, cause.getMessage());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return ResponseEntityDTO.failure(ResponseCode.FAILED);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p><strong>Tips:</strong> </p><ul><li>优化版本V1 在原来的基础上多增加了两层结构：arch-api-bean和arch-app-bean，使得骨架显得臃肿。能不能抽取出arch-bean，用于放置各种类型的bean？</li><li>创建扩展点对象是arch-client的职责吗？</li></ul><p>这两个问题留给读者思考，如有疑问请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="优化版本v2"></a>优化版本V2<a class="hash-link" href="#优化版本v2" title="Direct link to heading">#</a></h3><ol><li>调整模型的依赖结构，优化<a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv1">优化版本V1</a>中的优化点1、2，调整后的结构见下图
<img alt="software-design" src="/assets/images/software-multitier-inner-structure-84cc0e6a98988e14db6a3fec55e0f989.jpg"></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-app</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-domain</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  ├─model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  │  ├─converter # 用于存放实体模型转换</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  │  ├─do        # 领域实体模型，提供本领域内业务的方法</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  │  └─vo        # 值实体模型</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─service      # 轻service，内部调用do对象及repo完成业务逻辑</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│      └─facade   # 封装多个service的复杂操作</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-dal</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  ├─model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─repo         # 封装数据访问层的增删改查的操作</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-intgr</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  ├─facade       # 第三方接口出入参适配层</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─model        # 用于存放第三方实体模型</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-utils</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├─arch-api</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│  └─model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└─arch-client</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p><strong>Tips:</strong></p><ul><li>arch-app中@RestController下的接口实现arch-api包下的API接口。</li><li>arch-domain中service包下的接口继承自arch-api包下的API接口。为什么要继承API接口？这个问题留给读者思考，如有疑问请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</li><li>arch-api接口方法中加入@RequestMapping、@RequestBody、@RequestParam，避免arch-client和arch-app做相同的操作</li><li>arch-util放在总的pom中，横跨arch-dal、arch-intgr、arch-domain、arch-app</li></ul></blockquote><ol><li>调整arch-client中扩展点的代码，优化<a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv1">优化版本V1</a>中的优化点3，调整后的代码如下</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Component</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class XXXClientFallbackFactory extends GenericFallbackFactory&lt;IXXXApi&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public XXXClientFallbackFactory(){}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public XXXClientFallbackFactory(IXXXApi xxxApi){super(xxxApi);}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Slf4j</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public  class GenericFallbackFactory&lt;T&gt; implements FallbackFactory&lt;T&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public GenericFallbackFactory(){}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public GenericFallbackFactory(T extend){this.extend = extend;}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    protected   T extend;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @SuppressWarnings(&quot;unchecked&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public T create(Throwable cause) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        log.trace(&quot;fallback due to:{}&quot;, cause.getMessage(), cause);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (extend != null){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            log.debug(&quot;switch to extend fallback:{}&quot;, extend.getClass().getName());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return extend;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class ResponseEntityDTO&lt;T&gt; implements Serializable {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private static final long serialVersionUID = -8567541939288898127L;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final ResponseEntityDTO SUCCEED = new ResponseEntityDTO(ResponseCode.SUCCEED);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static final ResponseEntityDTO FAILED = new ResponseEntityDTO(ResponseCode.FAILED);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static &lt;T&gt; boolean successAndDataNotNull(ResponseEntityDTO&lt;T&gt; resp){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return success(resp) &amp;&amp; resp.data != null;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static &lt;T&gt; boolean success(ResponseEntityDTO&lt;T&gt; resp){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return resp == null ? false:resp.succeed();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static &lt;T&gt; ResponseEntityDTO&lt;T&gt; safeWrap(ResponseEntityDTO&lt;T&gt; resp){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return resp==null?FAILED: resp;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    T data;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    String message;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Integer errCode;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public boolean succeed() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return errCode==0;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public ResponseEntityDTO(ResponseCode code){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        message = code.getMessage();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        errCode = code.getCode();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // 此处省略其他代码</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p><strong>Tips:</strong></p><ul><li>将创建拓展点的任务交给业务使用方，业务使用方使用@Bean告知Spring如何构建对象，并将拓展的xxxApi传入到XXXClientFallbackFactory对象中</li><li>实现FallbackFactory接口的目的只是为了知晓请求失败的原因，比如：服务down机、网络超时等，所以GenericFallbackFactory中只要记录下日志就可以了</li><li>当业务使用方提供了拓展点，则使用业务方提供的拓展点，否则不会做任何处理。为什么不在GenericFallbackFactory中构造新的对象从而在方法中返回默认的返回体？这个问题留给读者思考，如有疑问请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</li><li>通过ResponseEntityDTO中的success、successAndDataNotNull对arch-client返回体做校验，safeWrap用于arch-app层，包装arch-domain层的返回体</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="优化版本v3"></a>优化版本V3<a class="hash-link" href="#优化版本v3" title="Direct link to heading">#</a></h3><ul><li>目前的骨架都是通过写好的模板，提供出去。可以通过一种自由的方式让用户去选择想要生成的骨架及使用的组件等。读者可以参考<a href="https://start.aliyun.com/" target="_blank" rel="noopener noreferrer">Aliyun Java Initializer</a>的实现</li><li>针对不同的业务提供不同的骨架</li><li><a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv2">优化版本V2</a>的方式能够满足单一技术栈的诉求，但是对于多技术栈显得无力。<a href="#%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%ACv2">优化版本V2</a>的方式本质上还是基于契约编程。可以从文档契约上去思考，
定义接口无非是定义好接口的出入参以及方法名。这块可以基于<a href="https://www.openapis.org/" target="_blank" rel="noopener noreferrer">openapi</a>去做，当接口定义完毕可发布时。接口的使用方，可以在接口文档的平台中生成各自技术栈的基于当前文档库版本号对应的库，再细化的可以生成当前技术栈使用的框架(spring cloud、dubbo、grpc等)对应的库(lib、dll、jar等)</li><li>往往规范的出发点都是好的，如何保证使用骨架的人按照规范去执行？可以通过提供各种ide(vscode、idea等)插件，去提示用户。即使提示了，用户还是没有执行。这时可以通过骨架质检平台，扫描接入骨架的业务代码库，定期做质检分析。这块可以基于<a href="https://www.archunit.org/" target="_blank" rel="noopener noreferrer">archunit</a>去做</li><li>此处留给读者思考，如果你有其他好的想法，请通过文末的<a href="#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F">联系方式</a>与我沟通</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="结语"></a>结语<a class="hash-link" href="#结语" title="Direct link to heading">#</a></h3><blockquote><ul><li>不断的优化设计，是为了使用的人能够更高效并快乐的工作</li><li>所有的软件设计并不是一蹴而就的</li><li>软件是要分层的，但也要注意粒度。比较的典型的案例:TCP/IP VS OSI/RM</li><li>一个好的软件设计者，一定是一个好的产品设计者</li><li>软件的设计最终一定要形成闭环</li><li>软件的设计是基于特定的业务使用场景的</li></ul></blockquote><p>今天是母亲节，祝天下所有的母亲节日快乐!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="联系方式"></a>联系方式<a class="hash-link" href="#联系方式" title="Direct link to heading">#</a></h3><ul><li>欢迎订阅我的公众号，这里主要会发表些软件工程上的一些想法及实践
<img alt="微信公众号" src="/assets/images/weixin-87aa5dc8406a7bddb435f74a81d745e9.jpg"></li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/blog/tags/design">design</a></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2020-05-09-software-design.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/build-monorepo"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« 构建单体仓库</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#骨架工程" class="table-of-contents__link">骨架工程</a><ul><li><a href="#名词解释" class="table-of-contents__link">名词解释</a></li><li><a href="#目录结构" class="table-of-contents__link">目录结构</a></li><li><a href="#结构图" class="table-of-contents__link">结构图</a></li><li><a href="#优化版本v1" class="table-of-contents__link">优化版本V1</a></li><li><a href="#优化版本v2" class="table-of-contents__link">优化版本V2</a></li><li><a href="#优化版本v3" class="table-of-contents__link">优化版本V3</a></li><li><a href="#结语" class="table-of-contents__link">结语</a></li><li><a href="#联系方式" class="table-of-contents__link">联系方式</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/doc1">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc1">Second Doc</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/lokiworks/lokiworks.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 lokiworks, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.90d50ffe.js"></script>
<script src="/assets/js/main.76acd87f.js"></script>
</body>
</html>